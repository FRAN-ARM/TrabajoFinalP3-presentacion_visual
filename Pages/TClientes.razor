@inject HttpClient Http
@using Blazored.SessionStorage;
@inject NavigationManager NavigationManager
@inject ISessionStorageService sessionStorage
@using Pages
@if (Cl == null)
{
  <p><em>Loading...</em></p>
}else{
  <div class="container m-0 p-3 mt-5" style="background-color: #825550; border-radius: 0.5rem;">
    <h3 class="text-center text-light">
            <strong>@Filtros.Titulo</strong>
      </h3>
    <div style="border-radius: 0.3rem; height: 500px; overflow-y: scroll;" class="container bg-light m-0 p-0">
      <table class="table">
        <thead class="thead" style="background-color: transparent;">
          <tr>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Correo</th>
            <th>Matricula</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var forecast in Cl)
            {
            if (forecast.id == Filtros.Busqueda || forecast.nombre == Filtros.Busqueda || forecast.apellido == Filtros.Busqueda || forecast.correo == Filtros.Busqueda)
            {
                fondo = "background-color: darkgray;";
            }
            else { fondo = ""; }
            <tr style="@fondo">
              <td>@forecast.nombre</td>
              <td>@forecast.apellido</td>
              <td>@forecast.correo</td>
              <td>@forecast.matricula</td>
              <td>
                 <button type="button" class="btn btn-info btn-sm" @onclick="() => EditarCliente(forecast.id)">Editar</button>
              </td>
              <td>
                 <button type="button" class="btn btn-danger btn-sm" @onclick="() => EliminarCliente(forecast.id)">Eliminar</button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
}

@code {

  string fondo = "";
  private Clientes[]? Cl;
  private string TituloL = "Nombre libro";

  protected override async Task OnInitializedAsync()
  {
        Cl = await Http.GetFromJsonAsync<Clientes[]>("https://localhost:7268/api/Cliente");
  }

    public async Task EliminarCliente(string id)
    {
        try
        {
            HttpResponseMessage response = await Http.DeleteAsync($"https://localhost:7268/api/Cliente/{id}");
            response.EnsureSuccessStatusCode();

            // Eliminación exitosa, recargar la lista de editoriales
            Cl = await Http.GetFromJsonAsync<Clientes[]>("https://localhost:7268/api/Cliente");
        }
        catch (Exception e)
        {
            Console.WriteLine($"Error al eliminar el editorial: {e.Message}");
        }
    }




    private async Task EditarCliente(string ClienteId)
    {

        await sessionStorage.SetItemAsync("ClienteId", ClienteId);


        NavigationManager.NavigateTo($"/PanelEditarCliente");

    }

  public class Clientes
  {
    public string? id { get; set; }
    public string? nombre { get; set; }
    public string? apellido { get; set; }
    public string? correo { get; set; }
    public int matricula { get; set; }
  }
}
